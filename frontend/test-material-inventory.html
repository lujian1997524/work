<!DOCTYPE html>
<html>
<head>
    <title>材料库存管理测试</title>
    <script>
        // 测试材料库存管理工作流的脚本
        function testMaterialInventoryFlow() {
            console.log('=== 材料库存管理工作流测试 ===');
            
            // 1. 测试API数据获取
            fetch('http://localhost:35001/api/worker-materials', {
                headers: {
                    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NCwibmFtZSI6IumrmOaYpeW8uiIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTc1NDI5MjEyMywiZXhwIjoxNzU0Mzc4NTIzfQ.EKWx901aDwhOzZG7UOvwVjJubm3ys4wdNrAHRRwxJ6k'
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log('✅ API数据获取成功');
                console.log('工人数量:', data.workers?.length || 0);
                console.log('厚度规格数量:', data.thicknessSpecs?.length || 0);
                
                // 检查高春强的数据
                const gaochunqiang = data.workers?.find(w => w.workerName === '高春强');
                if (gaochunqiang) {
                    console.log('✅ 找到高春强的数据');
                    console.log('高春强材料:', Object.keys(gaochunqiang.materials || {}));
                    
                    // 检查有库存的材料
                    const materialsWithStock = Object.entries(gaochunqiang.materials || {})
                        .filter(([key, data]) => data.quantity > 0);
                    console.log('高春强有库存的材料:', materialsWithStock.map(([key, data]) => `${key}: ${data.quantity}张`));
                } else {
                    console.error('❌ 没有找到高春强的数据');
                }
            })
            .catch(error => {
                console.error('❌ API数据获取失败:', error);
            });
        }
        
        // 页面加载完成后执行测试
        window.addEventListener('load', testMaterialInventoryFlow);
    </script>
</head>
<body>
    <h1>材料库存管理测试页面</h1>
    <p>请查看浏览器控制台获取测试结果</p>
    <button onclick="testMaterialInventoryFlow()">重新测试</button>
</body>
</html>